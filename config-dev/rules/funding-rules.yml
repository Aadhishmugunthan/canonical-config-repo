---
# FUNDING Event Rules - Complete Set


# Rule 1: Validate Required Metadata
- name: "FUNDING - Validate Required Metadata"
  description: "Ensure eventMetadata is not null or empty"
  priority: 2
  condition: "eventMetadata == null || eventMetadata.trim().isEmpty()"
  actions:
    - "envelope.setIgnore(true)"
    - "System.out.println('‚ö†Ô∏è  Rule: Ignoring FUNDING event with missing metadata: ' + envelope.getEventId())"


# Rule 2: Ignore Test Events
- name: "FUNDING - Ignore Test Events"
  description: "Ignore events from test environments"
  priority: 1
  condition: "eventSource != null && eventSource.toLowerCase().contains('test')"
  actions:
    - "envelope.setIgnore(true)"
    - "System.out.println('üß™ Rule: Ignoring TEST FUNDING event: ' + envelope.getEventId())"


# Rule 3: Validate Event Payload
- name: "FUNDING - Validate Payload"
  description: "Ensure event payload is not empty"
  priority: 2
  condition: "eventPayload == null || eventPayload.trim().isEmpty() || eventPayload.equals('{}') || eventPayload.equals('null')"
  actions:
    - "envelope.setIgnore(true)"
    - "System.out.println('‚ö†Ô∏è  Rule: Ignoring FUNDING event with empty payload: ' + envelope.getEventId())"


# Rule 4: Default ACQ_ICA to 0 if Non-Numeric
- name: "FUNDING - Default ACQ_ICA to 0 if Non-Numeric"
  description: "Set brand to 0 if value is non-numeric"
  priority: 3
  condition: "eventPayload.contains('brand') && eventPayload.contains('\"brand\":\"') && !eventPayload.matches('.*\"brand\":\"[0-9]+\".*')"
  actions:
    - "envelope.setEventPayload(eventPayload.replaceAll('\"brand\":\"[^\"]*\"', '\"brand\":\"0\"'))"
    - "System.out.println('üîß Rule: Set ACQ_ICA (brand) to default value 0 for FUNDING event: ' + envelope.getEventId())"


# Rule 5: Ignore if Funding Transaction ID Missing
- name: "FUNDING - Ignore if Transaction ID Missing"
  description: "Ignore events where fundingTransactionId is missing or null"
  priority: 1
  condition: "!eventPayload.contains('fundingTransactionId') || eventPayload.contains('\"fundingTransactionId\":null') || eventPayload.contains('\"fundingTransactionId\":\"\"')"
  actions:
    - "envelope.setIgnore(true)"
    - "System.out.println('‚ö†Ô∏è  Rule: Ignoring FUNDING event with missing fundingTransactionId: ' + envelope.getEventId())"


# Rule 6: Validate Event Source
- name: "FUNDING - Validate Event Source"
  description: "Ignore events from non-allowed event sources"
  priority: 1
  condition: "eventSource == null || (!eventSource.toUpperCase().contains('FND') && !eventSource.toUpperCase().contains('FUND'))"
  actions:
    - "envelope.setIgnore(true)"
    - "System.out.println('‚ö†Ô∏è  Rule: Ignoring FUNDING event from invalid source: ' + eventSource + ' for event: ' + envelope.getEventId())"


# Rule 7: Validate Regulatory Region
- name: "FUNDING - Validate Regulatory Region"
  description: "Ignore events from non-allowed regulatory regions (STL, ATL only)"
  priority: 1
  condition: "regulatoryRegion == null || (!regulatoryRegion.equalsIgnoreCase('STL') && !regulatoryRegion.equalsIgnoreCase('ATL'))"
  actions:
    - "envelope.setIgnore(true)"
    - "System.out.println('‚ö†Ô∏è  Rule: Ignoring FUNDING event from invalid regulatory region: ' + regulatoryRegion + ' for event: ' + envelope.getEventId())"


# Rule 8: Validate Funding Amount
- name: "FUNDING - Validate Funding Amount"
  description: "Ignore events where fundingAmount value is missing, null, or zero"
  priority: 2
  condition: "!eventPayload.contains('fundingAmount') || eventPayload.contains('\"value\":null') || eventPayload.contains('\"value\":0') || eventPayload.contains('\"value\":\"\"')"
  actions:
    - "envelope.setIgnore(true)"
    - "System.out.println('‚ö†Ô∏è  Rule: Ignoring FUNDING event with invalid fundingAmount for event: ' + envelope.getEventId())"


# Rule 9: Validate Funding Currency
- name: "FUNDING - Validate Funding Currency"
  description: "Ignore events where funding currency is missing or null"
  priority: 2
  condition: "!eventPayload.contains('\"currency\"') || eventPayload.contains('\"currency\":null') || eventPayload.contains('\"currency\":\"\"')"
  actions:
    - "envelope.setIgnore(true)"
    - "System.out.println('‚ö†Ô∏è  Rule: Ignoring FUNDING event with missing currency for event: ' + envelope.getEventId())"


# Rule 10: Validate Funding Method
- name: "FUNDING - Validate Funding Method"
  description: "Ignore events where fundingMethod is missing or null"
  priority: 2
  condition: "!eventPayload.contains('fundingMethod') || eventPayload.contains('\"fundingMethod\":null') || eventPayload.contains('\"fundingMethod\":\"\"')"
  actions:
    - "envelope.setIgnore(true)"
    - "System.out.println('‚ö†Ô∏è  Rule: Ignoring FUNDING event with missing fundingMethod for event: ' + envelope.getEventId())"


# Rule 11: Validate Source Account URI
- name: "FUNDING - Validate Source Account URI"
  description: "Ignore events where sourceAccountUri is missing or null"
  priority: 2
  condition: "!eventPayload.contains('sourceAccountUri') || eventPayload.contains('\"sourceAccountUri\":null') || eventPayload.contains('\"sourceAccountUri\":\"\"')"
  actions:
    - "envelope.setIgnore(true)"
    - "System.out.println('‚ö†Ô∏è  Rule: Ignoring FUNDING event with missing sourceAccountUri for event: ' + envelope.getEventId())"


# Rule 12: Default Response Code to UNKNOWN if Missing
- name: "FUNDING - Default Response Code if Missing"
  description: "Set responseCode to UNKNOWN if value is absent or empty"
  priority: 3
  condition: "!eventPayload.contains('responseCode') || eventPayload.contains('\"responseCode\":null') || eventPayload.contains('\"responseCode\":\"\"')"
  actions:
    - "envelope.setEventPayload(eventPayload.replaceAll('\"responseCode\":\"[^\"]*\"', '\"responseCode\":\"UNKNOWN\"'))"
    - "System.out.println('üîß Rule: Defaulted responseCode to UNKNOWN for FUNDING event: ' + envelope.getEventId())"
