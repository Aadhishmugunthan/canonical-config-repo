---
# PAYMENT Event Rules - Complete Set



# Rule 1: Validate Required Metadata
- name: "PAYMENT - Validate Required Metadata"
  description: "Ensure eventMetadata is not null or empty"
  priority: 2
  condition: "eventMetadata == null || eventMetadata.trim().isEmpty()"
  actions:
    - "envelope.setIgnore(true)"
    - "System.out.println('‚ö†Ô∏è  Rule: Ignoring event with missing metadata: ' + envelope.getEventId())"

# Rule 2: Ignore Test Events
- name: "PAYMENT - Ignore Test Events"
  description: "Ignore events from test environments"
  priority: 1
  condition: "eventSource != null && eventSource.toLowerCase().contains('test')"
  actions:
    - "envelope.setIgnore(true)"
    - "System.out.println('üß™ Rule: Ignoring TEST event: ' + envelope.getEventId())"

# Rule 3: Validate Event Payload
- name: "PAYMENT - Validate Payload"
  description: "Ensure event payload is not empty"
  priority: 2
  condition: "eventPayload == null || eventPayload.trim().isEmpty() || eventPayload.equals('{}') || eventPayload.equals('null')"
  actions:
    - "envelope.setIgnore(true)"
    - "System.out.println('‚ö†Ô∏è  Rule: Ignoring event with empty payload: ' + envelope.getEventId())"

# Rule 4: Default ACQ_ICA to 0 if Non-Numeric
- name: "PAYMENT - Default ACQ_ICA to 0 if Non-Numeric"
  description: "Set brand to 0 if value is non-numeric"
  priority: 3
  condition: "eventPayload.contains('brand') && eventPayload.contains('\"brand\":\"') && !eventPayload.matches('.*\"brand\":\"[0-9]+\".*')"
  actions:
    - "envelope.setEventPayload(eventPayload.replaceAll('\"brand\":\"[^\"]*\"', '\"brand\":\"0\"'))"
    - "System.out.println('üîß Rule: Set ACQ_ICA (brand) to default value 0 for event: ' + envelope.getEventId())"

# Rule 5: Ignore if Transaction ID Missing
- name: "PAYMENT - Ignore if Transaction ID Missing"
  description: "Ignore events where paymentTransactionId is missing or null"
  priority: 1
  condition: "!eventPayload.contains('paymentTransactionId') || eventPayload.contains('\"paymentTransactionId\":null') || eventPayload.contains('\"paymentTransactionId\":\"\"')"
  actions:
    - "envelope.setIgnore(true)"
    - "System.out.println('‚ö†Ô∏è  Rule: Ignoring event with missing paymentTransactionId: ' + envelope.getEventId())"

# Rule 6: Validate Event Source
- name: "PAYMENT - Validate Event Source"
  description: "Ignore events from non-allowed event sources"
  priority: 1
  condition: "eventSource == null || (!eventSource.toUpperCase().contains('PYT') && !eventSource.toUpperCase().contains('PMT') && !eventSource.toUpperCase().contains('PAY'))"
  actions:
    - "envelope.setIgnore(true)"
    - "System.out.println('‚ö†Ô∏è  Rule: Ignoring event from invalid source: ' + eventSource + ' for event: ' + envelope.getEventId())"

# Rule 7: Validate Regulatory Region
- name: "PAYMENT - Validate Regulatory Region"
  description: "Ignore events from non-allowed regulatory regions (STL, ATL only)"
  priority: 1
  condition: "regulatoryRegion == null || (!regulatoryRegion.equalsIgnoreCase('STL') && !regulatoryRegion.equalsIgnoreCase('ATL'))"
  actions:
    - "envelope.setIgnore(true)"
    - "System.out.println('‚ö†Ô∏è  Rule: Ignoring event from invalid regulatory region: ' + regulatoryRegion + ' for event: ' + envelope.getEventId())"


# Rule 8: Validate Payment Amount
- name: "PAYMENT - Validate Payment Amount"
  description: "Ignore events where paymentAmount value is missing, null, or zero"
  priority: 2
  condition: "!eventPayload.contains('paymentAmount') || eventPayload.contains('\"value\":null') || eventPayload.contains('\"value\":0') || eventPayload.contains('\"value\":\"\"')"
  actions:
    - "envelope.setIgnore(true)"
    - "System.out.println('‚ö†Ô∏è  Rule: Ignoring event with invalid paymentAmount for event: ' + envelope.getEventId())"

# Rule 9: Validate Payment Currency
- name: "PAYMENT - Validate Payment Currency"
  description: "Ignore events where payment currency is missing or null"
  priority: 2
  condition: "!eventPayload.contains('\"currency\"') || eventPayload.contains('\"currency\":null') || eventPayload.contains('\"currency\":\"\"')"
  actions:
    - "envelope.setIgnore(true)"
    - "System.out.println('‚ö†Ô∏è  Rule: Ignoring event with missing currency for event: ' + envelope.getEventId())"

# Rule 10: Validate Payment Method
- name: "PAYMENT - Validate Payment Method"
  description: "Ignore events where paymentMethod is missing or null"
  priority: 2
  condition: "!eventPayload.contains('paymentMethod') || eventPayload.contains('\"paymentMethod\":null') || eventPayload.contains('\"paymentMethod\":\"\"')"
  actions:
    - "envelope.setIgnore(true)"
    - "System.out.println('‚ö†Ô∏è  Rule: Ignoring event with missing paymentMethod for event: ' + envelope.getEventId())"

# Rule 11: Validate Debtor Account URI
- name: "PAYMENT - Validate Debtor Account URI"
  description: "Ignore events where debtorAccountUri is missing or null"
  priority: 2
  condition: "!eventPayload.contains('debtorAccountUri') || eventPayload.contains('\"debtorAccountUri\":null') || eventPayload.contains('\"debtorAccountUri\":\"\"')"
  actions:
    - "envelope.setIgnore(true)"
    - "System.out.println('‚ö†Ô∏è  Rule: Ignoring event with missing debtorAccountUri for event: ' + envelope.getEventId())"

# Rule 12: Default Response Code to UNKNOWN if Missing
- name: "PAYMENT - Default Response Code if Missing"
  description: "Set responseCode to UNKNOWN if value is absent or empty"
  priority: 3
  condition: "!eventPayload.contains('responseCode') || eventPayload.contains('\"responseCode\":null') || eventPayload.contains('\"responseCode\":\"\"')"
  actions:
    - "envelope.setEventPayload(eventPayload.replaceAll('\"responseCode\":\"[^\"]*\"', '\"responseCode\":\"UNKNOWN\"'))"
    - "System.out.println('üîß Rule: Defaulted responseCode to UNKNOWN for event: ' + envelope.getEventId())"

